<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kegel Men</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#020617;
  color:#f8fafc;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:#0f172a;
  width:100%;
  max-width:420px;
  padding:16px;
  border-radius:22px;
}
h1{text-align:center;color:#38bdf8;margin:6px 0;}
select,button,input{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  border:none;
  font-size:15px;
}
select,input{background:#1e293b;color:white;}
button{background:#38bdf8;color:#020617;font-weight:600;}
.secondary{background:#334155;color:white;}
.state{text-align:center;font-size:18px;margin-top:8px;}
.time{text-align:center;font-size:36px;margin:6px 0;}
.small{text-align:center;font-size:12px;color:#cbd5f5;}

.chat{
  background:#020617;
  border-radius:14px;
  padding:8px;
  height:140px;
  overflow-y:auto;
  font-size:13px;
  margin-top:8px;
}
.msg-user{color:#38bdf8;margin:4px 0;}
.msg-ai{color:#a7f3d0;margin:4px 0;}

canvas{
  background:#020617;
  border-radius:12px;
  margin-top:8px;
}
</style>
</head>

<body>
<div class="card">
<h1>Kegel Men</h1>

<select id="profileSelect"></select>
<input id="newProfile" placeholder="Nuevo perfil" />
<button onclick="createProfile()">Crear perfil</button>

<select id="program">
  <option value="">Elegir programa</option>
  <option value="micro">âš¡ Micro</option>
  <option value="normal">ðŸŸ¢ Normal</option>
  <option value="medium">ðŸŸ¡ Medio</option>
  <option value="long">ðŸ”µ Extenso</option>
</select>

<div class="state" id="state">Listo</div>
<div class="time" id="time">â€“</div>

<button id="start" disabled>Iniciar</button>
<button class="secondary" id="pause" disabled>Pausar</button>

<canvas id="chart" width="380" height="110"></canvas>

<div class="chat" id="chat"></div>
<input id="chatInput" placeholder="Habla con tu coachâ€¦" />
<button class="secondary" onclick="sendMsg()">Enviar ðŸ’¬</button>

<div class="small">Coach dinÃ¡mico Â· 100% local</div>
</div>

<script>
/* ===== PROGRAMAS ===== */
const programs={
 micro:{h:3,r:3,reps:10},
 normal:{h:5,r:5,reps:20},
 medium:{h:6,r:6,reps:30},
 long:{h:7,r:7,reps:35}
};

/* ===== PERFILES ===== */
function getProfiles(){
 return JSON.parse(localStorage.getItem("profiles")||"{}");
}
function saveProfiles(p){
 localStorage.setItem("profiles",JSON.stringify(p));
}
let profiles=getProfiles();
let currentProfile=null;

const profileSelect=document.getElementById("profileSelect");

function autoTest(){
 const q1=confirm("Â¿Te preocupa hacerlo correctamente?");
 const q2=confirm("Â¿Necesitas motivaciÃ³n constante?");
 if(q1 && q2) return "mixed";
 if(q1) return "clinical";
 if(q2) return "emotional";
 return "fitness";
}

function refreshProfiles(){
 profileSelect.innerHTML="";
 Object.keys(profiles).forEach(n=>{
  const o=document.createElement("option");
  o.value=n;o.textContent=n;
  profileSelect.appendChild(o);
 });
 if(!currentProfile && Object.keys(profiles).length){
  currentProfile=Object.keys(profiles)[0];
 }
 profileSelect.value=currentProfile||"";
 drawChart();
}

function createProfile(){
 const name=document.getElementById("newProfile").value.trim();
 if(!name||profiles[name])return;
 profiles[name]={log:{},style:autoTest(),sessions:0};
 saveProfiles(profiles);
 currentProfile=name;
 refreshProfiles();
 addMsg("Perfil creado. AjustÃ© tu coach segÃºn tus respuestas.","ai");
}

profileSelect.onchange=e=>{
 currentProfile=e.target.value;
 drawChart();
 addMsg("Perfil cargado. Continuamos.","ai");
};

/* ===== CHAT ===== */
const chat=document.getElementById("chat");
function addMsg(t,type){
 const d=document.createElement("div");
 d.className=type==="user"?"msg-user":"msg-ai";
 d.textContent=t;
 chat.appendChild(d);
 chat.scrollTop=chat.scrollHeight;
}

addMsg("Soy tu coach. Te acompaÃ±o durante toda la sesiÃ³n.","ai");

function contextualCoach(){
 const p=profiles[currentProfile];
 if(!p) return "Empezamos cuando quieras.";

 const progress=rep/(currentProgram?.reps||1);

 if(paused) return "Pausa bien hecha. Respira profundo y retomamos cuando estÃ©s listo.";

 if(progress===0){
   return "Comenzamos con calma. Encuentra el mÃºsculo, respira natural y no fuerces.";
 }
 if(progress<0.4){
   return "Buen ritmo. ConcÃ©ntrate en la contracciÃ³n sin apretar abdomen ni glÃºteos.";
 }
 if(progress<0.8){
   return "AquÃ­ es donde se construye el progreso. MantÃ©n control y constancia.";
 }
 return "Ãšltimos ciclos. TÃ©cnica limpia, sin tensiÃ³n extra. EstÃ¡s cerrando bien.";
}

function sendMsg(){
 const i=document.getElementById("chatInput");
 const t=i.value.trim();
 if(!t||!currentProfile)return;
 addMsg(t,"user");
 i.value="";
 setTimeout(()=>addMsg(contextualCoach(),"ai"),400);
}

/* ===== TEMPORIZADOR ===== */
let currentProgram=null,phase="hold",timeLeft=0,rep=0,interval=null,paused=false;
const stateEl=document.getElementById("state");
const timeEl=document.getElementById("time");
const startBtn=document.getElementById("start");
const pauseBtn=document.getElementById("pause");

document.getElementById("program").onchange=e=>{
 currentProgram=programs[e.target.value];
 startBtn.disabled=!currentProgram;
};

startBtn.onclick=()=>{
 if(!currentProgram||!currentProfile)return;
 rep=0;phase="hold";timeLeft=currentProgram.h;paused=false;
 startBtn.disabled=true;pauseBtn.disabled=false;
 stateEl.textContent="Contrae";timeEl.textContent=timeLeft;
 addMsg("Iniciamos. Hoy cuenta la constancia, no la fuerza.","ai");
 interval=setInterval(tick,1000);
};

pauseBtn.onclick=()=>{
 paused=!paused;
 pauseBtn.textContent=paused?"Reanudar":"Pausar";
 addMsg(contextualCoach(),"ai");
};

function tick(){
 if(paused)return;
 timeLeft--;timeEl.textContent=timeLeft;
 if(timeLeft<=0){
  if(phase==="hold"){
    phase="relax";stateEl.textContent="Relaja";timeLeft=currentProgram.r;
  }else{
    rep++;
    if(rep>=currentProgram.reps){finish();return;}
    phase="hold";stateEl.textContent="Contrae";timeLeft=currentProgram.h;
    if(rep%5===0) addMsg(contextualCoach(),"ai");
  }
 }
}

function finish(){
 clearInterval(interval);
 stateEl.textContent="Completado âœ”";
 timeEl.textContent="âœ“";
 pauseBtn.disabled=true;
 startBtn.disabled=false;
 profiles[currentProfile].sessions++;
 saveSession();
 drawChart();
 addMsg("SesiÃ³n completa. MaÃ±ana tu cuerpo lo agradecerÃ¡.","ai");
}

/* ===== HISTORIAL + GRÃFICO ===== */
function saveSession(){
 const d=new Date().toISOString().slice(0,10);
 const log=profiles[currentProfile].log;
 log[d]=(log[d]||0)+1;
 saveProfiles(profiles);
}

function drawChart(){
 const c=document.getElementById("chart");
 const ctx=c.getContext("2d");
 ctx.clearRect(0,0,c.width,c.height);
 if(!currentProfile)return;
 const log=profiles[currentProfile].log;
 const days=[];
 for(let i=6;i>=0;i--){
  const d=new Date();d.setDate(d.getDate()-i);
  days.push(d.toISOString().slice(0,10));
 }
 const max=Math.max(1,...days.map(d=>log[d]||0));
 days.forEach((d,i)=>{
  const v=log[d]||0;
  const h=(v/max)*80;
  ctx.fillStyle="#38bdf8";
  ctx.fillRect(10+i*50,100-h,20,h);
 });
}

/* ===== INIT ===== */
refreshProfiles();
</script>
</body>
</html>
